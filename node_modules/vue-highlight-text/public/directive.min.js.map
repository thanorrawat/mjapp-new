{"version":3,"file":"directive.min.js","sources":["../src/components/Utils.js","../src/components/HighlightText.js"],"sourcesContent":["const toStyleString = require('to-style').string\n\nconst defaultStyle = {\n  color: '#00C1E8'\n}\n\nconst escapeRegExp = function(str) {\n  return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|\\<\\>]/g, '\\\\$&')\n}\n\n/**\n * This func may be used by \"HighlightText.js(v-highlight-text)\" or used to mark the keywors for html content from server.\n * <br/>\n *  For some reason, you can't use v-html and v-highlight-text together.\n *  You can format the html content using this function and then display it with 'v-html'\n *\n * @param message\n * @param keyword\n * @param flags\n * @param newStyle\n * @returns {*}\n */\nconst highlightSearch = function(message, keyword, flags = 'g', newStyle = defaultStyle) {\n  let styleString = `style=\"${toStyleString(newStyle)}\"`\n  let newKeyword = keyword\n  let regexWord = ''\n  if (typeof keyword === 'string') {\n    if (/^\\s*$/.test(keyword)) {\n      // when the keyword is empty string, return the original message.\n      return escapeHtml(message)\n    }\n    regexWord =  escapeRegExp(newKeyword)\n  } else if (Array.isArray(keyword) && keyword.length > 0) {\n    let kws = keyword.filter(s => !/^\\s*$/.test(keyword))\n    if (kws.length === 0) {\n      // when the keyword is empty string, return the original message.\n      return escapeHtml(message)\n    }\n    regexWord = keyword.map(k => escapeRegExp(k)).join('|')\n  } else {\n    console.warn('type is not String or Array')\n    // return ''\n    return escapeHtml(message)\n  }\n\n  // const match = new RegExp(`(${regexWord})`, flags)\n  // Can only replace the words out of the html tags.\n  const match = new RegExp(`(${regexWord})`, flags)\n  const testMath = match.test(message)\n  if (testMath) {\n    // return escapeHtml(message).replace(match, `<span ${styleString}>\\$&</span>`)\n    const replaced = message.replace(match, `:;{{:;\\$&:;}}:;`)\n    const matchAgain = new RegExp(`:;{{:;(${escapeHtml(regexWord)}):;}}:;`, flags)\n    const restoreReplaced = escapeHtml(replaced).replace(matchAgain, `<span class=\"highlighted\" ${styleString}>\\$1</span>`)\n    return restoreReplaced\n  }\n  return escapeHtml(message)\n}\n\n\n\nconst escapeHtml = (unsafe) => {\n  return unsafe\n    .replace(/&/g, `&amp;`)\n    .replace(/</g, `&lt;`)\n    .replace(/>/g, `&gt;`)\n    .replace(/\"/g, `&quot;`)\n    .replace(/'/g, `&#039;`)\n}\n\nconst unescapeHtml = (safe) => {\n  return safe\n    .replace(/&amp;/g, `&`)\n    .replace(/&lt;/g, `<`)\n    .replace(/&gt;/g, `>`)\n    .replace(/&quot;/g, `\"`)\n    .replace(/&#039;/g, `'`)\n}\n\nexport default {highlightSearch, defaultStyle, escapeHtml, unescapeHtml}\n","import utils from './Utils'\n\nconst getFlags = function(sensitive) {\n  let flag = 'g'\n  flag = !sensitive ? flag + 'i' : flag\n  return flag\n}\n\nconst checkStyle = overWriteStyle => !!overWriteStyle && JSON.stringify(overWriteStyle) !== '{}'\nconst copyObj = obj => JSON.parse(JSON.stringify(obj))\n\nconst beforeHighlight = (el, binding, original) => {\n  const {\n    value: { keyword, sensitive, overWriteStyle }\n  } = binding\n\n  if (!keyword || keyword === '') {\n    const escaseOriginal = utils.escapeHtml(original)\n    el.innerHTML = replaceWithOriginal(escaseOriginal, escaseOriginal)\n    return\n  }\n\n  let newStyle = copyObj(utils.defaultStyle)\n\n  if (checkStyle(overWriteStyle)) {\n    newStyle = Object.assign(newStyle, overWriteStyle)\n  }\n\n  const newSensitive = sensitive === undefined ? true : sensitive\n  const highlight = utils.highlightSearch(original, keyword, getFlags(newSensitive), newStyle)\n  el.innerHTML = replaceWithOriginal(utils.escapeHtml(original), highlight)\n}\n\nconst replaceWithOriginal = (original, newText) => {\n  return `<p style=\"display:none;\">${original}</p>${newText}`\n}\n\nexport default {\n  bind(el, binding) {\n    const originalString = el.innerHTML+''\n    el.innerHTML = replaceWithOriginal(originalString, originalString)\n    beforeHighlight(el, binding, utils.unescapeHtml(originalString))\n  },\n  componentUpdated(el, binding, vnode) {\n    const originalString = utils.escapeHtml(vnode.children[0].text)\n    el.innerHTML = replaceWithOriginal(originalString, originalString)\n    beforeHighlight(el, binding, utils.unescapeHtml(originalString))\n  },\n  unbind(el) {\n    el.innerHTML = el.children[0].innerHTML\n  }\n}\n"],"names":["toStyleString","require","string","defaultStyle","color","escapeRegExp","str","replace","escapeHtml","unsafe","highlightSearch","message","keyword","flags","newStyle","styleString","newKeyword","regexWord","test","Array","isArray","length","console","warn","filter","s","map","k","join","match","RegExp","replaced","matchAgain","unescapeHtml","safe","beforeHighlight","el","binding","original","value","sensitive","overWriteStyle","obj","utils","JSON","parse","stringify","checkStyle","Object","assign","newSensitive","undefined","highlight","flag","getFlags","innerHTML","replaceWithOriginal","escaseOriginal","newText","bind","originalString","componentUpdated","vnode","children","text","unbind"],"mappings":";;;;;4LAAA,IAAMA,EAAgBC,QAAQ,YAAYC,OAEpCC,GACJC,MAAO,WAGHC,EAAe,SAASC,UACrBA,EAAIC,QAAQ,0CAA2C,SAsD1DC,EAAa,SAACC,UACXA,EACJF,QAAQ,cACRA,QAAQ,aACRA,QAAQ,aACRA,QAAQ,eACRA,QAAQ,mBAYGG,gBAzDQ,SAASC,EAASC,OAASC,yDAAQ,IAAKC,yDAAWX,EACrEY,mBAAwBf,EAAcc,QACtCE,EAAaJ,EACbK,EAAY,MACO,iBAAZL,EAAsB,IAC3B,QAAQM,KAAKN,UAERJ,EAAWG,GAEpBM,EAAaZ,EAAaW,OACrB,CAAA,KAAIG,MAAMC,QAAQR,IAAYA,EAAQS,OAAS,UAQpDC,QAAQC,KAAK,+BAENf,EAAWG,MARC,IADTC,EAAQY,OAAO,SAAAC,UAAM,QAAQP,KAAKN,KACpCS,cAECb,EAAWG,GAEpBM,EAAYL,EAAQc,IAAI,SAAAC,UAAKtB,EAAasB,KAAIC,KAAK,SAS/CC,EAAQ,IAAIC,kBAAWb,OAAcJ,MAC1BgB,EAAMX,KAAKP,GACd,KAENoB,EAAWpB,EAAQJ,QAAQsB,oBAC3BG,EAAa,IAAIF,wBAAiBtB,EAAWS,cAAqBJ,UAChDL,EAAWuB,GAAUxB,QAAQyB,sCAAyCjB,wBAGzFP,EAAWG,IAuBaR,aAAAA,EAAcK,WAAAA,EAAYyB,aATtC,SAACC,UACbA,EACJ3B,QAAQ,cACRA,QAAQ,aACRA,QAAQ,aACRA,QAAQ,eACRA,QAAQ,iBCjEP4B,EAAkB,SAACC,EAAIC,EAASC,SAGhCD,EADFE,MAAS3B,IAAAA,QAAS4B,IAAAA,UAAWC,IAAAA,kBAG1B7B,GAAuB,KAAZA,OAPF8B,EAaV5B,GAbU4B,EAaSC,EAAMxC,aAbRyC,KAAKC,MAAMD,KAAKE,UAAUJ,MAD9B,SAAAD,WAAoBA,GAAqD,OAAnCG,KAAKE,UAAUL,IAgBlEM,CAAWN,KACb3B,EAAWkC,OAAOC,OAAOnC,EAAU2B,QAG/BS,OAA6BC,IAAdX,GAAiCA,EAChDY,EAAYT,EAAMjC,gBAAgB4B,EAAU1B,EA3BnC,SAAS4B,OACpBa,EAAO,WACXA,EAAQb,EAAyBa,EAAbA,EAAO,IAyBgCC,CAASJ,GAAepC,GACnFsB,EAAGmB,UAAYC,EAAoBb,EAAMnC,WAAW8B,GAAWc,YAbvDK,EAAiBd,EAAMnC,WAAW8B,GACxCF,EAAGmB,UAAYC,EAAoBC,EAAgBA,KAejDD,EAAsB,SAAClB,EAAUoB,4CACFpB,iBAAeoB,WAIlDC,cAAKvB,EAAIC,OACDuB,EAAiBxB,EAAGmB,UAAU,GACpCnB,EAAGmB,UAAYC,EAAoBI,EAAgBA,GACnDzB,EAAgBC,EAAIC,EAASM,EAAMV,aAAa2B,KAElDC,0BAAiBzB,EAAIC,EAASyB,OACtBF,EAAiBjB,EAAMnC,WAAWsD,EAAMC,SAAS,GAAGC,MAC1D5B,EAAGmB,UAAYC,EAAoBI,EAAgBA,GACnDzB,EAAgBC,EAAIC,EAASM,EAAMV,aAAa2B,KAElDK,gBAAO7B,GACLA,EAAGmB,UAAYnB,EAAG2B,SAAS,GAAGR"}